{"version":3,"sources":["iframeResizer.contentWindow.js"],"names":["undefined","addEventListener","el","evt","func","window","attachEvent","removeEventListener","detachEvent","capitalizeFirstLetter","string","charAt","toUpperCase","slice","throttle","context","args","result","timeout","previous","later","getNow","apply","now","remaining","throttledTimer","this","arguments","clearTimeout","setTimeout","formatLogMsg","msg","msgID","myID","log","logging","console","warn","init","readDataFromParent","location","href","readDataFromPage","setMargin","setBodyStyle","bodyBackground","bodyPadding","injectClearFixIntoBodyElement","checkHeightMode","checkWidthMode","stopInfiniteResizingOfIFrame","setupPublicMethods","startEventListeners","inPageLinks","setupInPageLinks","sendSize","readyCallback","strBool","str","data","initMsg","substr","msgIdLen","split","bodyMargin","Number","calculateWidth","interval","autoResize","bodyMarginStr","heightCalcMode","tolerance","enable","resizeFrom","widthCalcMode","readData","iFrameResizer","JSON","stringify","messageCallback","targetOriginDefault","targetOrigin","heightCalculationMethod","widthCalculationMethod","setupCustomCalcMethods","calcMode","calcFunc","customCalcMethods","Object","constructor","chkCSS","attr","value","indexOf","document","body","style","documentElement","height","manageTriggerEvent","options","listener","add","eventName","handleEvent","eventType","eventHandlersByName","remove","eventNames","Array","prototype","map","method","manageEventListeners","checkCalcMode","calcModeDefault","modes","type","heightCalcModeDefault","getHeight","widthCalcModeDefault","getWidth","setupMutationObserver","stopMsgsToParent","sendPermit","removeMsgListener","receiver","disconnectMutationObserver","bodyObserver","disconnect","stopEventListeners","clearInterval","intervalTimer","teardown","clearFix","createElement","clear","display","appendChild","getPagePosition","x","pageXOffset","scrollLeft","y","pageYOffset","scrollTop","getElementPosition","elPosition","getBoundingClientRect","pagePosition","parseInt","left","top","findTarget","jumpToTarget","target","jumpPosition","hash","sendMsg","hashData","decodeURIComponent","getElementById","getElementsByName","checkLocationHash","bindAnchors","setupLink","linkClicked","e","preventDefault","getAttribute","forEach","call","querySelectorAll","bindLocationHash","initCheck","eventCancelTimer","enableInPageLinks","win","parentIFrame","resize","close","getId","getPageInfo","callback","pageInfoCallback","moveToAnchor","reset","resetIFrame","scrollTo","scrollToOffset","sendMessage","setHeightCalculationMethod","setWidthCalculationMethod","setTargetOrigin","size","customHeight","customWidth","initInterval","setInterval","Math","abs","setupBodyMutationObserver","addImageLoadListners","mutation","addImageLoadListener","element","complete","src","imageLoaded","imageError","elements","push","attributeName","removeFromArray","splice","removeImageLoadListener","imageEventTriggered","event","typeDesc","mutationObserved","mutations","createMutationObserver","querySelector","config","attributes","attributeOldValue","characterData","characterDataOldValue","childList","subtree","observer","MutationObserver","observe","WebKitMutationObserver","forceIntervalTimer","getComputedStyle","prop","convertUnitsToPxForIE8","test","base","runtimeStyle","currentStyle","pixelLeft","retVal","defaultView","chkEventThottle","timer","getMaxElement","side","elementsLength","length","elVal","maxVal","Side","i","getAllMeasurements","dimention","bodyOffset","bodyScroll","documentElementOffset","documentElementScroll","getTaggedElements","tag","noTaggedElementsFound","getAllElements","sizeIFrame","triggerEvent","triggerEventDesc","resizeIFrame","currentHeight","width","currentWidth","isSizeChangeDetected","checkTolarance","a","b","isForceResizableEvent","isForceResizableCalcMode","resetRequiredMethods","logIgnored","checkDownSizing","innerWidth","innerHeight","lockTrigger","recordTrigger","resetPage","isDoubleFiredEvent","triggerLocked","doubleEventList","sizeIFrameThrottled","triggerLockedTimer","triggerReset","hcm","sendToParent","message","postMessage","isMessageForUs","getMessageType","getData","isMiddleTier","module","exports","isInitMsg","true","false","callFromParent","messageType","processRequestFromParent","processMessage","firstRun","fireInit","source","initLock","readyState","initFromParent","inPageLink","pageInfo","msgBody","parse","chkLateLoaded","parent","click","max","min","offsetHeight","scrollWidth","Date","getTime","offset","scrollHeight","custom","grow","lowestElement","taggedElement","offsetWidth","scroll","rightMostElement"],"mappings":"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","file":"iframeResizer.contentWindow.min.js","sourcesContent":["/*\r\n * File: iframeResizer.contentWindow.js\r\n * Desc: Include this file in any page being loaded into an iframe\r\n *       to force the iframe to resize to the content size.\r\n * Requires: iframeResizer.js on host page.\r\n * Doc: https://github.com/davidjbradshaw/iframe-resizer\r\n * Author: David J. Bradshaw - dave@bradshaw.net\r\n * Contributor: Jure Mav - jure.mav@gmail.com\r\n * Contributor: Ian Caunce - ian@hallnet.co.uk\r\n */\r\n\r\n\r\n;(function(undefined) {\r\n\t'use strict';\r\n\r\n\tif(typeof window === 'undefined') return; // don't run for server side render\r\n\r\n\tvar\r\n\t\tautoResize            = true,\r\n\t\tbase                  = 10,\r\n\t\tbodyBackground        = '',\r\n\t\tbodyMargin            = 0,\r\n\t\tbodyMarginStr         = '',\r\n\t\tbodyObserver          = null,\r\n\t\tbodyPadding           = '',\r\n\t\tcalculateWidth        = false,\r\n\t\tdoubleEventList       = {'resize':1,'click':1},\r\n\t\teventCancelTimer      = 128,\r\n\t\tfirstRun              = true,\r\n\t\theight                = 1,\r\n\t\theightCalcModeDefault = 'bodyOffset',\r\n\t\theightCalcMode        = heightCalcModeDefault,\r\n\t\tinitLock              = true,\r\n\t\tinitMsg               = '',\r\n\t\tinPageLinks           = {},\r\n\t\tinterval              = 32,\r\n\t\tintervalTimer         = null,\r\n\t\tlogging               = false,\r\n\t\tmsgID                 = '[iFrameSizer]',  //Must match host page msg ID\r\n\t\tmsgIdLen              = msgID.length,\r\n\t\tmyID                  = '',\r\n\t\tobserver              = null,\r\n\t\tresetRequiredMethods  = {max:1,min:1,bodyScroll:1,documentElementScroll:1},\r\n\t\tresizeFrom            = 'child',\r\n\t\tsendPermit            = true,\r\n\t\ttarget                = window.parent,\r\n\t\ttargetOriginDefault   = '*',\r\n\t\ttolerance             = 0,\r\n\t\ttriggerLocked         = false,\r\n\t\ttriggerLockedTimer    = null,\r\n\t\tthrottledTimer        = 16,\r\n\t\twidth                 = 1,\r\n\t\twidthCalcModeDefault  = 'scroll',\r\n\t\twidthCalcMode         = widthCalcModeDefault,\r\n\t\twin                   = window,\r\n\t\tmessageCallback       = function(){ warn('MessageCallback function not defined'); },\r\n\t\treadyCallback         = function(){},\r\n\t\tpageInfoCallback      = function(){},\r\n\t\tcustomCalcMethods     = {\r\n\t\t\theight: function(){\r\n\t\t\t\twarn('Custom height calculation function not defined');\r\n\t\t\t\treturn document.documentElement.offsetHeight;\r\n\t\t\t},\r\n\t\t\twidth: function(){\r\n\t\t\t\twarn('Custom width calculation function not defined');\r\n\t\t\t\treturn document.body.scrollWidth;\r\n\t\t\t}\r\n\t\t},\r\n\t\teventHandlersByName   = {};\r\n\r\n\r\n\tfunction addEventListener(el,evt,func){\r\n\t\t/* istanbul ignore else */ // Not testable in phantonJS\r\n\t\tif ('addEventListener' in window){\r\n\t\t\tel.addEventListener(evt,func, false);\r\n\t\t} else if ('attachEvent' in window){ //IE\r\n\t\t\tel.attachEvent('on'+evt,func);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction removeEventListener(el,evt,func){\r\n\t\t/* istanbul ignore else */ // Not testable in phantonJS\r\n\t\tif ('removeEventListener' in window){\r\n\t\t\tel.removeEventListener(evt,func, false);\r\n\t\t} else if ('detachEvent' in window){ //IE\r\n\t\t\tel.detachEvent('on'+evt,func);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction capitalizeFirstLetter(string) {\r\n\t\treturn string.charAt(0).toUpperCase() + string.slice(1);\r\n\t}\r\n\r\n\t//Based on underscore.js\r\n\tfunction throttle(func) {\r\n\t\tvar\r\n\t\t\tcontext, args, result,\r\n\t\t\ttimeout = null,\r\n\t\t\tprevious = 0,\r\n\t\t\tlater = function() {\r\n\t\t\t\tprevious = getNow();\r\n\t\t\t\ttimeout = null;\r\n\t\t\t\tresult = func.apply(context, args);\r\n\t\t\t\tif (!timeout) {\r\n\t\t\t\t\tcontext = args = null;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\treturn function() {\r\n\t\t\tvar now = getNow();\r\n\r\n\t\t\tif (!previous) {\r\n\t\t\t\tprevious = now;\r\n\t\t\t}\r\n\r\n\t\t\tvar remaining = throttledTimer - (now - previous);\r\n\r\n\t\t\tcontext = this;\r\n\t\t\targs = arguments;\r\n\r\n\t\t\tif (remaining <= 0 || remaining > throttledTimer) {\r\n\t\t\t\tif (timeout) {\r\n\t\t\t\t\tclearTimeout(timeout);\r\n\t\t\t\t\ttimeout = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tprevious = now;\r\n\t\t\t\tresult = func.apply(context, args);\r\n\r\n\t\t\t\tif (!timeout) {\r\n\t\t\t\t\tcontext = args = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if (!timeout) {\r\n\t\t\t\ttimeout = setTimeout(later, remaining);\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t};\r\n\t}\r\n\r\n\tvar getNow = Date.now || function() {\r\n\t\t/* istanbul ignore next */ // Not testable in PhantonJS\r\n\t\treturn new Date().getTime();\r\n\t};\r\n\r\n\tfunction formatLogMsg(msg){\r\n\t\treturn msgID + '[' + myID + ']' + ' ' + msg;\r\n\t}\r\n\r\n\tfunction log(msg){\r\n\t\tif (logging && ('object' === typeof window.console)){\r\n\t\t\tconsole.log(formatLogMsg(msg));\r\n\t\t}\r\n\t}\r\n\r\n\tfunction warn(msg){\r\n\t\tif ('object' === typeof window.console){\r\n\t\t\tconsole.warn(formatLogMsg(msg));\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction init(){\r\n\t\treadDataFromParent();\r\n\t\tlog('Initialising iFrame ('+location.href+')');\r\n\t\treadDataFromPage();\r\n\t\tsetMargin();\r\n\t\tsetBodyStyle('background',bodyBackground);\r\n\t\tsetBodyStyle('padding',bodyPadding);\r\n\t\tinjectClearFixIntoBodyElement();\r\n\t\tcheckHeightMode();\r\n\t\tcheckWidthMode();\r\n\t\tstopInfiniteResizingOfIFrame();\r\n\t\tsetupPublicMethods();\r\n\t\tstartEventListeners();\r\n\t\tinPageLinks = setupInPageLinks();\r\n\t\tsendSize('init','Init message from host page');\r\n\t\treadyCallback();\r\n\t}\r\n\r\n\tfunction readDataFromParent(){\r\n\r\n\t\tfunction strBool(str){\r\n\t\t\treturn 'true' === str ? true : false;\r\n\t\t}\r\n\r\n\t\tvar data = initMsg.substr(msgIdLen).split(':');\r\n\r\n\t\tmyID               = data[0];\r\n\t\tbodyMargin         = (undefined !== data[1]) ? Number(data[1])   : bodyMargin; //For V1 compatibility\r\n\t\tcalculateWidth     = (undefined !== data[2]) ? strBool(data[2])  : calculateWidth;\r\n\t\tlogging            = (undefined !== data[3]) ? strBool(data[3])  : logging;\r\n\t\tinterval           = (undefined !== data[4]) ? Number(data[4])   : interval;\r\n\t\tautoResize         = (undefined !== data[6]) ? strBool(data[6])  : autoResize;\r\n\t\tbodyMarginStr      = data[7];\r\n\t\theightCalcMode     = (undefined !== data[8]) ? data[8]           : heightCalcMode;\r\n\t\tbodyBackground     = data[9];\r\n\t\tbodyPadding        = data[10];\r\n\t\ttolerance          = (undefined !== data[11]) ? Number(data[11]) : tolerance;\r\n\t\tinPageLinks.enable = (undefined !== data[12]) ? strBool(data[12]): false;\r\n\t\tresizeFrom         = (undefined !== data[13]) ? data[13]         : resizeFrom;\r\n\t\twidthCalcMode      = (undefined !== data[14]) ? data[14]         : widthCalcMode;\r\n\t}\r\n\r\n\tfunction readDataFromPage(){\r\n\t\tfunction readData(){\r\n\t\t\tvar data = window.iFrameResizer;\r\n\r\n\t\t\tlog('Reading data from page: ' + JSON.stringify(data));\r\n\r\n\t\t\tmessageCallback     = ('messageCallback'         in data) ? data.messageCallback         : messageCallback;\r\n\t\t\treadyCallback       = ('readyCallback'           in data) ? data.readyCallback           : readyCallback;\r\n\t\t\ttargetOriginDefault = ('targetOrigin'            in data) ? data.targetOrigin            : targetOriginDefault;\r\n\t\t\theightCalcMode      = ('heightCalculationMethod' in data) ? data.heightCalculationMethod : heightCalcMode;\r\n\t\t\twidthCalcMode       = ('widthCalculationMethod'  in data) ? data.widthCalculationMethod  : widthCalcMode;\r\n\t\t}\r\n\r\n\t\tfunction setupCustomCalcMethods(calcMode, calcFunc){\r\n\t\t\tif ('function' === typeof calcMode) {\r\n\t\t\t\tlog('Setup custom ' + calcFunc + 'CalcMethod');\r\n\t\t\t\tcustomCalcMethods[calcFunc] = calcMode;\r\n\t\t\t\tcalcMode = 'custom';\r\n\t\t\t}\r\n\r\n\t\t\treturn calcMode;\r\n\t\t}\r\n\r\n\t\tif(('iFrameResizer' in window) && (Object === window.iFrameResizer.constructor)) {\r\n\t\t\treadData();\r\n\t\t\theightCalcMode = setupCustomCalcMethods(heightCalcMode, 'height');\r\n\t\t\twidthCalcMode  = setupCustomCalcMethods(widthCalcMode,  'width');\r\n\t\t}\r\n\r\n\t\tlog('TargetOrigin for parent set to: ' + targetOriginDefault);\r\n\t}\r\n\r\n\r\n\tfunction chkCSS(attr,value){\r\n\t\tif (-1 !== value.indexOf('-')){\r\n\t\t\twarn('Negative CSS value ignored for '+attr);\r\n\t\t\tvalue='';\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\tfunction setBodyStyle(attr,value){\r\n\t\tif ((undefined !== value) && ('' !== value) && ('null' !== value)){\r\n\t\t\tdocument.body.style[attr] = value;\r\n\t\t\tlog('Body '+attr+' set to \"'+value+'\"');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction setMargin(){\r\n\t\t//If called via V1 script, convert bodyMargin from int to str\r\n\t\tif (undefined === bodyMarginStr){\r\n\t\t\tbodyMarginStr = bodyMargin+'px';\r\n\t\t}\r\n\r\n\t\tsetBodyStyle('margin',chkCSS('margin',bodyMarginStr));\r\n\t}\r\n\r\n\tfunction stopInfiniteResizingOfIFrame(){\r\n\t\tdocument.documentElement.style.height = '';\r\n\t\tdocument.body.style.height = '';\r\n\t\tlog('HTML & body height set to \"auto\"');\r\n\t}\r\n\r\n\r\n\tfunction manageTriggerEvent(options){\r\n\r\n\t\tvar listener = {\r\n\t\t\tadd:    function(eventName){\r\n\t\t\t\tfunction handleEvent(){\r\n\t\t\t\t\tsendSize(options.eventName,options.eventType);\r\n\t\t\t\t}\r\n\r\n\t\t\t\teventHandlersByName[eventName] = handleEvent;\r\n\r\n\t\t\t\taddEventListener(window,eventName,handleEvent);\r\n\t\t\t},\r\n\t\t\tremove: function(eventName){\r\n\t\t\t\tvar handleEvent = eventHandlersByName[eventName];\r\n\t\t\t\tdelete eventHandlersByName[eventName];\r\n\r\n\t\t\t\tremoveEventListener(window,eventName,handleEvent);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tif(options.eventNames && Array.prototype.map){\r\n\t\t\toptions.eventName = options.eventNames[0];\r\n\t\t\toptions.eventNames.map(listener[options.method]);\r\n\t\t} else {\r\n\t\t\tlistener[options.method](options.eventName);\r\n\t\t}\r\n\r\n\t\tlog(capitalizeFirstLetter(options.method) + ' event listener: ' + options.eventType);\r\n\t}\r\n\r\n\tfunction manageEventListeners(method){\r\n\t\tmanageTriggerEvent({method:method, eventType: 'Animation Start',           eventNames: ['animationstart','webkitAnimationStart'] });\r\n\t\tmanageTriggerEvent({method:method, eventType: 'Animation Iteration',       eventNames: ['animationiteration','webkitAnimationIteration'] });\r\n\t\tmanageTriggerEvent({method:method, eventType: 'Animation End',             eventNames: ['animationend','webkitAnimationEnd'] });\r\n\t\tmanageTriggerEvent({method:method, eventType: 'Input',                     eventName:  'input' });\r\n\t\tmanageTriggerEvent({method:method, eventType: 'Mouse Up',                  eventName:  'mouseup' });\r\n\t\tmanageTriggerEvent({method:method, eventType: 'Mouse Down',                eventName:  'mousedown' });\r\n\t\tmanageTriggerEvent({method:method, eventType: 'Orientation Change',        eventName:  'orientationchange' });\r\n\t\tmanageTriggerEvent({method:method, eventType: 'Print',                     eventName:  ['afterprint', 'beforeprint'] });\r\n\t\tmanageTriggerEvent({method:method, eventType: 'Ready State Change',        eventName:  'readystatechange' });\r\n\t\tmanageTriggerEvent({method:method, eventType: 'Touch Start',               eventName:  'touchstart' });\r\n\t\tmanageTriggerEvent({method:method, eventType: 'Touch End',                 eventName:  'touchend' });\r\n\t\tmanageTriggerEvent({method:method, eventType: 'Touch Cancel',              eventName:  'touchcancel' });\r\n\t\tmanageTriggerEvent({method:method, eventType: 'Transition Start',          eventNames: ['transitionstart','webkitTransitionStart','MSTransitionStart','oTransitionStart','otransitionstart'] });\r\n\t\tmanageTriggerEvent({method:method, eventType: 'Transition Iteration',      eventNames: ['transitioniteration','webkitTransitionIteration','MSTransitionIteration','oTransitionIteration','otransitioniteration'] });\r\n\t\tmanageTriggerEvent({method:method, eventType: 'Transition End',            eventNames: ['transitionend','webkitTransitionEnd','MSTransitionEnd','oTransitionEnd','otransitionend'] });\r\n\t\tif('child' === resizeFrom){\r\n\t\t\tmanageTriggerEvent({method:method, eventType: 'IFrame Resized',        eventName:  'resize' });\r\n\t\t}\r\n\t}\r\n\r\n\tfunction checkCalcMode(calcMode,calcModeDefault,modes,type){\r\n\t\tif (calcModeDefault !== calcMode){\r\n\t\t\tif (!(calcMode in modes)){\r\n\t\t\t\twarn(calcMode + ' is not a valid option for '+type+'CalculationMethod.');\r\n\t\t\t\tcalcMode=calcModeDefault;\r\n\t\t\t}\r\n\t\t\tlog(type+' calculation method set to \"'+calcMode+'\"');\r\n\t\t}\r\n\r\n\t\treturn calcMode;\r\n\t}\r\n\r\n\tfunction checkHeightMode(){\r\n\t\theightCalcMode = checkCalcMode(heightCalcMode,heightCalcModeDefault,getHeight,'height');\r\n\t}\r\n\r\n\tfunction checkWidthMode(){\r\n\t\twidthCalcMode = checkCalcMode(widthCalcMode,widthCalcModeDefault,getWidth,'width');\r\n\t}\r\n\r\n\tfunction startEventListeners(){\r\n\t\tif ( true === autoResize ) {\r\n\t\t\tmanageEventListeners('add');\r\n\t\t\tsetupMutationObserver();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlog('Auto Resize disabled');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction stopMsgsToParent(){\r\n\t\tlog('Disable outgoing messages');\r\n\t\tsendPermit = false;\r\n\t}\r\n\r\n\tfunction removeMsgListener(){\r\n\t\tlog('Remove event listener: Message');\r\n\t\tremoveEventListener(window, 'message', receiver);\r\n\t}\r\n\r\n\tfunction disconnectMutationObserver(){\r\n\t\tif (null !== bodyObserver){\r\n\t\t\t/* istanbul ignore next */ // Not testable in PhantonJS\r\n\t\t\tbodyObserver.disconnect();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction stopEventListeners(){\r\n\t\tmanageEventListeners('remove');\r\n\t\tdisconnectMutationObserver();\r\n\t\tclearInterval(intervalTimer);\r\n\t}\r\n\r\n\tfunction teardown(){\r\n\t\tstopMsgsToParent();\r\n\t\tremoveMsgListener();\r\n\t\tif (true === autoResize) stopEventListeners();\r\n\t}\r\n\r\n\tfunction injectClearFixIntoBodyElement(){\r\n\t\tvar clearFix = document.createElement('div');\r\n\t\tclearFix.style.clear   = 'both';\r\n\t\tclearFix.style.display = 'block'; //Guard against this having been globally redefined in CSS.\r\n\t\tdocument.body.appendChild(clearFix);\r\n\t}\r\n\r\n\tfunction setupInPageLinks(){\r\n\r\n\t\tfunction getPagePosition (){\r\n\t\t\treturn {\r\n\t\t\t\tx: (window.pageXOffset !== undefined) ? window.pageXOffset : document.documentElement.scrollLeft,\r\n\t\t\t\ty: (window.pageYOffset !== undefined) ? window.pageYOffset : document.documentElement.scrollTop\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfunction getElementPosition(el){\r\n\t\t\tvar\r\n\t\t\t\telPosition   = el.getBoundingClientRect(),\r\n\t\t\t\tpagePosition = getPagePosition();\r\n\r\n\t\t\treturn {\r\n\t\t\t\tx: parseInt(elPosition.left,10) + parseInt(pagePosition.x,10),\r\n\t\t\t\ty: parseInt(elPosition.top,10)  + parseInt(pagePosition.y,10)\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfunction findTarget(location){\r\n\t\t\tfunction jumpToTarget(target){\r\n\t\t\t\tvar jumpPosition = getElementPosition(target);\r\n\r\n\t\t\t\tlog('Moving to in page link (#'+hash+') at x: '+jumpPosition.x+' y: '+jumpPosition.y);\r\n\t\t\t\tsendMsg(jumpPosition.y, jumpPosition.x, 'scrollToOffset'); // X&Y reversed at sendMsg uses height/width\r\n\t\t\t}\r\n\r\n\t\t\tvar\r\n\t\t\t\thash     = location.split('#')[1] || location, //Remove # if present\r\n\t\t\t\thashData = decodeURIComponent(hash),\r\n\t\t\t\ttarget   = document.getElementById(hashData) || document.getElementsByName(hashData)[0];\r\n\r\n\t\t\tif (undefined !== target){\r\n\t\t\t\tjumpToTarget(target);\r\n\t\t\t} else {\r\n\t\t\t\tlog('In page link (#' + hash + ') not found in iFrame, so sending to parent');\r\n\t\t\t\tsendMsg(0,0,'inPageLink','#'+hash);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction checkLocationHash(){\r\n\t\t\tif ('' !== location.hash && '#' !== location.hash){\r\n\t\t\t\tfindTarget(location.href);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction bindAnchors(){\r\n\t\t\tfunction setupLink(el){\r\n\t\t\t\tfunction linkClicked(e){\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t/*jshint validthis:true */\r\n\t\t\t\t\tfindTarget(this.getAttribute('href'));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ('#' !== el.getAttribute('href')){\r\n\t\t\t\t\taddEventListener(el,'click',linkClicked);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tArray.prototype.forEach.call( document.querySelectorAll( 'a[href^=\"#\"]' ), setupLink );\r\n\t\t}\r\n\r\n\t\tfunction bindLocationHash(){\r\n\t\t\taddEventListener(window,'hashchange',checkLocationHash);\r\n\t\t}\r\n\r\n\t\tfunction initCheck(){ //check if page loaded with location hash after init resize\r\n\t\t\tsetTimeout(checkLocationHash,eventCancelTimer);\r\n\t\t}\r\n\r\n\t\tfunction enableInPageLinks(){\r\n\t\t\t/* istanbul ignore else */ // Not testable in phantonJS\r\n\t\t\tif(Array.prototype.forEach && document.querySelectorAll){\r\n\t\t\t\tlog('Setting up location.hash handlers');\r\n\t\t\t\tbindAnchors();\r\n\t\t\t\tbindLocationHash();\r\n\t\t\t\tinitCheck();\r\n\t\t\t} else {\r\n\t\t\t\twarn('In page linking not fully supported in this browser! (See README.md for IE8 workaround)');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(inPageLinks.enable){\r\n\t\t\tenableInPageLinks();\r\n\t\t} else {\r\n\t\t\tlog('In page linking not enabled');\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tfindTarget:findTarget\r\n\t\t};\r\n\t}\r\n\r\n\tfunction setupPublicMethods(){\r\n\t\tlog('Enable public methods');\r\n\r\n\t\twin.parentIFrame = {\r\n\r\n\t\t\tautoResize: function autoResizeF(resize){\r\n\t\t\t\tif (true === resize && false === autoResize) {\r\n\t\t\t\t\tautoResize=true;\r\n\t\t\t\t\tstartEventListeners();\r\n\t\t\t\t\t//sendSize('autoResize','Auto Resize enabled');\r\n\t\t\t\t} else if (false === resize && true === autoResize) {\r\n\t\t\t\t\tautoResize=false;\r\n\t\t\t\t\tstopEventListeners();\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn autoResize;\r\n\t\t\t},\r\n\r\n\t\t\tclose: function closeF(){\r\n\t\t\t\tsendMsg(0,0,'close');\r\n\t\t\t\tteardown();\r\n\t\t\t},\r\n\r\n\t\t\tgetId: function getIdF(){\r\n\t\t\t\treturn myID;\r\n\t\t\t},\r\n\r\n\t\t\tgetPageInfo: function getPageInfoF(callback){\r\n\t\t\t\tif ('function' === typeof callback){\r\n\t\t\t\t\tpageInfoCallback = callback;\r\n\t\t\t\t\tsendMsg(0,0,'pageInfo');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpageInfoCallback = function(){};\r\n\t\t\t\t\tsendMsg(0,0,'pageInfoStop');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tmoveToAnchor: function moveToAnchorF(hash){\r\n\t\t\t\tinPageLinks.findTarget(hash);\r\n\t\t\t},\r\n\r\n\t\t\treset: function resetF(){\r\n\t\t\t\tresetIFrame('parentIFrame.reset');\r\n\t\t\t},\r\n\r\n\t\t\tscrollTo: function scrollToF(x,y){\r\n\t\t\t\tsendMsg(y,x,'scrollTo'); // X&Y reversed at sendMsg uses height/width\r\n\t\t\t},\r\n\r\n\t\t\tscrollToOffset: function scrollToF(x,y){\r\n\t\t\t\tsendMsg(y,x,'scrollToOffset'); // X&Y reversed at sendMsg uses height/width\r\n\t\t\t},\r\n\r\n\t\t\tsendMessage: function sendMessageF(msg,targetOrigin){\r\n\t\t\t\tsendMsg(0,0,'message',JSON.stringify(msg),targetOrigin);\r\n\t\t\t},\r\n\r\n\t\t\tsetHeightCalculationMethod: function setHeightCalculationMethodF(heightCalculationMethod){\r\n\t\t\t\theightCalcMode = heightCalculationMethod;\r\n\t\t\t\tcheckHeightMode();\r\n\t\t\t},\r\n\r\n\t\t\tsetWidthCalculationMethod: function setWidthCalculationMethodF(widthCalculationMethod){\r\n\t\t\t\twidthCalcMode = widthCalculationMethod;\r\n\t\t\t\tcheckWidthMode();\r\n\t\t\t},\r\n\r\n\t\t\tsetTargetOrigin: function setTargetOriginF(targetOrigin){\r\n\t\t\t\tlog('Set targetOrigin: '+targetOrigin);\r\n\t\t\t\ttargetOriginDefault = targetOrigin;\r\n\t\t\t},\r\n\r\n\t\t\tsize: function sizeF(customHeight, customWidth){\r\n\t\t\t\tvar valString = ''+(customHeight?customHeight:'')+(customWidth?','+customWidth:'');\r\n\t\t\t\t//lockTrigger();\r\n\t\t\t\tsendSize('size','parentIFrame.size('+valString+')', customHeight, customWidth);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tfunction initInterval(){\r\n\t\tif ( 0 !== interval ){\r\n\t\t\tlog('setInterval: '+interval+'ms');\r\n\t\t\tintervalTimer = setInterval(function(){\r\n\t\t\t\tsendSize('interval','setInterval: '+interval);\r\n\t\t\t},Math.abs(interval));\r\n\t\t}\r\n\t}\r\n\r\n\t/* istanbul ignore next */  //Not testable in PhantomJS\r\n\tfunction setupBodyMutationObserver(){\r\n\t\tfunction addImageLoadListners(mutation) {\r\n\t\t\tfunction addImageLoadListener(element){\r\n\t\t\t\tif (false === element.complete) {\r\n\t\t\t\t\tlog('Attach listeners to ' + element.src);\r\n\t\t\t\t\telement.addEventListener('load', imageLoaded, false);\r\n\t\t\t\t\telement.addEventListener('error', imageError, false);\r\n\t\t\t\t\telements.push(element);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (mutation.type === 'attributes' && mutation.attributeName === 'src'){\r\n\t\t\t\taddImageLoadListener(mutation.target);\r\n\t\t\t} else if (mutation.type === 'childList'){\r\n\t\t\t\tArray.prototype.forEach.call(\r\n\t\t\t\t\tmutation.target.querySelectorAll('img'),\r\n\t\t\t\t\taddImageLoadListener\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction removeFromArray(element){\r\n\t\t\telements.splice(elements.indexOf(element),1);\r\n\t\t}\r\n\r\n\t\tfunction removeImageLoadListener(element){\r\n\t\t\tlog('Remove listeners from ' + element.src);\r\n\t\t\telement.removeEventListener('load', imageLoaded, false);\r\n\t\t\telement.removeEventListener('error', imageError, false);\r\n\t\t\tremoveFromArray(element);\r\n\t\t}\r\n\r\n\t\tfunction imageEventTriggered(event,type,typeDesc){\r\n\t\t\tremoveImageLoadListener(event.target);\r\n\t\t\tsendSize(type, typeDesc + ': ' + event.target.src, undefined, undefined);\r\n\t\t}\r\n\r\n\t\tfunction imageLoaded(event) {\r\n\t\t\timageEventTriggered(event,'imageLoad','Image loaded');\r\n\t\t}\r\n\r\n\t\tfunction imageError(event) {\r\n\t\t\timageEventTriggered(event,'imageLoadFailed','Image load failed');\r\n\t\t}\r\n\r\n\t\tfunction mutationObserved(mutations) {\r\n\t\t\tsendSize('mutationObserver','mutationObserver: ' + mutations[0].target + ' ' + mutations[0].type);\r\n\r\n\t\t\t//Deal with WebKit asyncing image loading when tags are injected into the page\r\n\t\t\tmutations.forEach(addImageLoadListners);\r\n\t\t}\r\n\r\n\t\tfunction createMutationObserver(){\r\n\t\t\tvar\r\n\t\t\t\ttarget = document.querySelector('body'),\r\n\r\n\t\t\t\tconfig = {\r\n\t\t\t\t\tattributes            : true,\r\n\t\t\t\t\tattributeOldValue     : false,\r\n\t\t\t\t\tcharacterData         : true,\r\n\t\t\t\t\tcharacterDataOldValue : false,\r\n\t\t\t\t\tchildList             : true,\r\n\t\t\t\t\tsubtree               : true\r\n\t\t\t\t};\r\n\r\n\t\t\tobserver = new MutationObserver(mutationObserved);\r\n\r\n\t\t\tlog('Create body MutationObserver');\r\n\t\t\tobserver.observe(target, config);\r\n\r\n\t\t\treturn observer;\r\n\t\t}\r\n\r\n\t\tvar\r\n\t\t\telements         = [],\r\n\t\t\tMutationObserver = window.MutationObserver || window.WebKitMutationObserver,\r\n\t\t\tobserver         = createMutationObserver();\r\n\r\n\t\treturn {\r\n\t\t\tdisconnect: function (){\r\n\t\t\t\tif ('disconnect' in observer){\r\n\t\t\t\t\tlog('Disconnect body MutationObserver');\r\n\t\t\t\t\tobserver.disconnect();\r\n\t\t\t\t\telements.forEach(removeImageLoadListener);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tfunction setupMutationObserver(){\r\n\t\tvar\tforceIntervalTimer = 0 > interval;\r\n\r\n\t\t/* istanbul ignore if */ // Not testable in PhantomJS\r\n\t\tif (window.MutationObserver || window.WebKitMutationObserver){\r\n\t\t\tif (forceIntervalTimer) {\r\n\t\t\t\tinitInterval();\r\n\t\t\t} else {\r\n\t\t\t\tbodyObserver = setupBodyMutationObserver();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlog('MutationObserver not supported in this browser!');\r\n\t\t\tinitInterval();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t// document.documentElement.offsetHeight is not reliable, so\r\n\t// we have to jump through hoops to get a better value.\r\n\tfunction getComputedStyle(prop,el) {\r\n\t\t/* istanbul ignore next */  //Not testable in PhantomJS\r\n\t\tfunction convertUnitsToPxForIE8(value) {\r\n\t\t\tvar PIXEL = /^\\d+(px)?$/i;\r\n\r\n\t\t\tif (PIXEL.test(value)) {\r\n\t\t\t\treturn parseInt(value,base);\r\n\t\t\t}\r\n\r\n\t\t\tvar\r\n\t\t\t\tstyle = el.style.left,\r\n\t\t\t\truntimeStyle = el.runtimeStyle.left;\r\n\r\n\t\t\tel.runtimeStyle.left = el.currentStyle.left;\r\n\t\t\tel.style.left = value || 0;\r\n\t\t\tvalue = el.style.pixelLeft;\r\n\t\t\tel.style.left = style;\r\n\t\t\tel.runtimeStyle.left = runtimeStyle;\r\n\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\tvar retVal = 0;\r\n\t\tel =  el || document.body;\r\n\r\n\t\t/* istanbul ignore else */ // Not testable in phantonJS\r\n\t\tif (('defaultView' in document) && ('getComputedStyle' in document.defaultView)) {\r\n\t\t\tretVal = document.defaultView.getComputedStyle(el, null);\r\n\t\t\tretVal = (null !== retVal) ? retVal[prop] : 0;\r\n\t\t} else {//IE8\r\n\t\t\tretVal =  convertUnitsToPxForIE8(el.currentStyle[prop]);\r\n\t\t}\r\n\r\n\t\treturn parseInt(retVal,base);\r\n\t}\r\n\r\n\tfunction chkEventThottle(timer){\r\n\t\tif(timer > throttledTimer/2){\r\n\t\t\tthrottledTimer = 2*timer;\r\n\t\t\tlog('Event throttle increased to ' + throttledTimer + 'ms');\r\n\t\t}\r\n\t}\r\n\r\n\t//Idea from https://github.com/guardian/iframe-messenger\r\n\tfunction getMaxElement(side,elements) {\r\n\t\tvar\r\n\t\t\telementsLength = elements.length,\r\n\t\t\telVal          = 0,\r\n\t\t\tmaxVal         = 0,\r\n\t\t\tSide           = capitalizeFirstLetter(side),\r\n\t\t\ttimer          = getNow();\r\n\r\n\t\tfor (var i = 0; i < elementsLength; i++) {\r\n\t\t\telVal = elements[i].getBoundingClientRect()[side] + getComputedStyle('margin'+Side,elements[i]);\r\n\t\t\tif (elVal > maxVal) {\r\n\t\t\t\tmaxVal = elVal;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttimer = getNow() - timer;\r\n\r\n\t\tlog('Parsed '+elementsLength+' HTML elements');\r\n\t\tlog('Element position calculated in ' + timer + 'ms');\r\n\r\n\t\tchkEventThottle(timer);\r\n\r\n\t\treturn maxVal;\r\n\t}\r\n\r\n\tfunction getAllMeasurements(dimention){\r\n\t\treturn [\r\n\t\t\tdimention.bodyOffset(),\r\n\t\t\tdimention.bodyScroll(),\r\n\t\t\tdimention.documentElementOffset(),\r\n\t\t\tdimention.documentElementScroll()\r\n\t\t];\r\n\t}\r\n\r\n\tfunction getTaggedElements(side,tag){\r\n\t\tfunction noTaggedElementsFound(){\r\n\t\t\twarn('No tagged elements ('+tag+') found on page');\r\n\t\t\treturn document.querySelectorAll('body *');\r\n\t\t}\r\n\r\n\t\tvar elements = document.querySelectorAll('['+tag+']');\r\n\r\n\t\tif (0 === elements.length) noTaggedElementsFound();\r\n\r\n\t\treturn getMaxElement(side,elements);\r\n\t}\r\n\r\n\tfunction getAllElements(){\r\n\t\treturn document.querySelectorAll('body *');\r\n\t}\r\n\r\n\tvar\r\n\t\tgetHeight = {\r\n\t\t\tbodyOffset: function getBodyOffsetHeight(){\r\n\t\t\t\treturn  document.body.offsetHeight + getComputedStyle('marginTop') + getComputedStyle('marginBottom');\r\n\t\t\t},\r\n\r\n\t\t\toffset: function(){\r\n\t\t\t\treturn getHeight.bodyOffset(); //Backwards compatability\r\n\t\t\t},\r\n\r\n\t\t\tbodyScroll: function getBodyScrollHeight(){\r\n\t\t\t\treturn document.body.scrollHeight;\r\n\t\t\t},\r\n\r\n\t\t\tcustom: function getCustomWidth(){\r\n\t\t\t\treturn customCalcMethods.height();\r\n\t\t\t},\r\n\r\n\t\t\tdocumentElementOffset: function getDEOffsetHeight(){\r\n\t\t\t\treturn document.documentElement.offsetHeight;\r\n\t\t\t},\r\n\r\n\t\t\tdocumentElementScroll: function getDEScrollHeight(){\r\n\t\t\t\treturn document.documentElement.scrollHeight;\r\n\t\t\t},\r\n\r\n\t\t\tmax: function getMaxHeight(){\r\n\t\t\t\treturn Math.max.apply(null,getAllMeasurements(getHeight));\r\n\t\t\t},\r\n\r\n\t\t\tmin: function getMinHeight(){\r\n\t\t\t\treturn Math.min.apply(null,getAllMeasurements(getHeight));\r\n\t\t\t},\r\n\r\n\t\t\tgrow: function growHeight(){\r\n\t\t\t\treturn getHeight.max(); //Run max without the forced downsizing\r\n\t\t\t},\r\n\r\n\t\t\tlowestElement: function getBestHeight(){\r\n\t\t\t\treturn Math.max(getHeight.bodyOffset(), getMaxElement('bottom',getAllElements()));\r\n\t\t\t},\r\n\r\n\t\t\ttaggedElement: function getTaggedElementsHeight(){\r\n\t\t\t\treturn getTaggedElements('bottom','data-iframe-height');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetWidth = {\r\n\t\t\tbodyScroll: function getBodyScrollWidth(){\r\n\t\t\t\treturn document.body.scrollWidth;\r\n\t\t\t},\r\n\r\n\t\t\tbodyOffset: function getBodyOffsetWidth(){\r\n\t\t\t\treturn document.body.offsetWidth;\r\n\t\t\t},\r\n\r\n\t\t\tcustom: function getCustomWidth(){\r\n\t\t\t\treturn customCalcMethods.width();\r\n\t\t\t},\r\n\r\n\t\t\tdocumentElementScroll: function getDEScrollWidth(){\r\n\t\t\t\treturn document.documentElement.scrollWidth;\r\n\t\t\t},\r\n\r\n\t\t\tdocumentElementOffset: function getDEOffsetWidth(){\r\n\t\t\t\treturn document.documentElement.offsetWidth;\r\n\t\t\t},\r\n\r\n\t\t\tscroll: function getMaxWidth(){\r\n\t\t\t\treturn Math.max(getWidth.bodyScroll(), getWidth.documentElementScroll());\r\n\t\t\t},\r\n\r\n\t\t\tmax: function getMaxWidth(){\r\n\t\t\t\treturn Math.max.apply(null,getAllMeasurements(getWidth));\r\n\t\t\t},\r\n\r\n\t\t\tmin: function getMinWidth(){\r\n\t\t\t\treturn Math.min.apply(null,getAllMeasurements(getWidth));\r\n\t\t\t},\r\n\r\n\t\t\trightMostElement: function rightMostElement(){\r\n\t\t\t\treturn getMaxElement('right', getAllElements());\r\n\t\t\t},\r\n\r\n\t\t\ttaggedElement: function getTaggedElementsWidth(){\r\n\t\t\t\treturn getTaggedElements('right', 'data-iframe-width');\r\n\t\t\t}\r\n\t\t};\r\n\r\n\r\n\tfunction sizeIFrame(triggerEvent, triggerEventDesc, customHeight, customWidth){\r\n\r\n\t\tfunction resizeIFrame(){\r\n\t\t\theight = currentHeight;\r\n\t\t\twidth  = currentWidth;\r\n\r\n\t\t\tsendMsg(height,width,triggerEvent);\r\n\t\t}\r\n\r\n\t\tfunction isSizeChangeDetected(){\r\n\t\t\tfunction checkTolarance(a,b){\r\n\t\t\t\tvar retVal = Math.abs(a-b) <= tolerance;\r\n\t\t\t\treturn !retVal;\r\n\t\t\t}\r\n\r\n\t\t\tcurrentHeight = (undefined !== customHeight)  ? customHeight : getHeight[heightCalcMode]();\r\n\t\t\tcurrentWidth  = (undefined !== customWidth )  ? customWidth  : getWidth[widthCalcMode]();\r\n\r\n\t\t\treturn\tcheckTolarance(height,currentHeight) || (calculateWidth && checkTolarance(width,currentWidth));\r\n\t\t}\r\n\r\n\t\tfunction isForceResizableEvent(){\r\n\t\t\treturn !(triggerEvent in {'init':1,'interval':1,'size':1});\r\n\t\t}\r\n\r\n\t\tfunction isForceResizableCalcMode(){\r\n\t\t\treturn (heightCalcMode in resetRequiredMethods) || (calculateWidth && widthCalcMode in resetRequiredMethods);\r\n\t\t}\r\n\r\n\t\tfunction logIgnored(){\r\n\t\t\tlog('No change in size detected');\r\n\t\t}\r\n\r\n\t\tfunction checkDownSizing(){\r\n\t\t\tif (isForceResizableEvent() && isForceResizableCalcMode()){\r\n\t\t\t\tresetIFrame(triggerEventDesc);\r\n\t\t\t} else if (!(triggerEvent in {'interval':1})){\r\n\t\t\t\tlogIgnored();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(window.innerWidth === 0 || window.innerHeight === 0) return;\r\n\r\n\t\tvar\tcurrentHeight,currentWidth;\r\n\r\n\t\tif (isSizeChangeDetected() || 'init' === triggerEvent){\r\n\t\t\tlockTrigger();\r\n\t\t\tresizeIFrame();\r\n\t\t} else {\r\n\t\t\tcheckDownSizing();\r\n\t\t}\r\n\t}\r\n\r\n\tvar sizeIFrameThrottled = throttle(sizeIFrame);\r\n\r\n\tfunction sendSize(triggerEvent, triggerEventDesc, customHeight, customWidth){\r\n\t\tfunction recordTrigger(){\r\n\t\t\tif (!(triggerEvent in {'reset':1,'resetPage':1,'init':1})){\r\n\t\t\t\tlog( 'Trigger event: ' + triggerEventDesc );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction isDoubleFiredEvent(){\r\n\t\t\treturn  triggerLocked && (triggerEvent in doubleEventList);\r\n\t\t}\r\n\r\n\t\tif (!isDoubleFiredEvent()){\r\n\t\t\trecordTrigger();\r\n\t\t\tsizeIFrameThrottled(triggerEvent, triggerEventDesc, customHeight, customWidth);\r\n\t\t} else {\r\n\t\t\tlog('Trigger event cancelled: '+triggerEvent);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction lockTrigger(){\r\n\t\tif (!triggerLocked){\r\n\t\t\ttriggerLocked = true;\r\n\t\t\tlog('Trigger event lock on');\r\n\t\t}\r\n\t\tclearTimeout(triggerLockedTimer);\r\n\t\ttriggerLockedTimer = setTimeout(function(){\r\n\t\t\ttriggerLocked = false;\r\n\t\t\tlog('Trigger event lock off');\r\n\t\t\tlog('--');\r\n\t\t},eventCancelTimer);\r\n\t}\r\n\r\n\tfunction triggerReset(triggerEvent){\r\n\t\theight = getHeight[heightCalcMode]();\r\n\t\twidth  = getWidth[widthCalcMode]();\r\n\r\n\t\tsendMsg(height,width,triggerEvent);\r\n\t}\r\n\r\n\tfunction resetIFrame(triggerEventDesc){\r\n\t\tvar hcm = heightCalcMode;\r\n\t\theightCalcMode = heightCalcModeDefault;\r\n\r\n\t\tlog('Reset trigger event: ' + triggerEventDesc);\r\n\t\tlockTrigger();\r\n\t\ttriggerReset('reset');\r\n\r\n\t\theightCalcMode = hcm;\r\n\t}\r\n\r\n\tfunction sendMsg(height,width,triggerEvent,msg,targetOrigin){\r\n\t\tfunction setTargetOrigin(){\r\n\t\t\tif (undefined === targetOrigin){\r\n\t\t\t\ttargetOrigin = targetOriginDefault;\r\n\t\t\t} else {\r\n\t\t\t\tlog('Message targetOrigin: '+targetOrigin);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction sendToParent(){\r\n\t\t\tvar\r\n\t\t\t\tsize  = height + ':' + width,\r\n\t\t\t\tmessage = myID + ':' +  size + ':' + triggerEvent + (undefined !== msg ? ':' + msg : '');\r\n\r\n\t\t\tlog('Sending message to host page (' + message + ')');\r\n\t\t\ttarget.postMessage( msgID + message, targetOrigin);\r\n\t\t}\r\n\r\n\t\tif(true === sendPermit){\r\n\t\t\tsetTargetOrigin();\r\n\t\t\tsendToParent();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction receiver(event) {\r\n\t\tvar processRequestFromParent = {\r\n\t\t\tinit: function initFromParent(){\r\n\t\t\t\tfunction fireInit(){\r\n\t\t\t\t\tinitMsg = event.data;\r\n\t\t\t\t\ttarget  = event.source;\r\n\r\n\t\t\t\t\tinit();\r\n\t\t\t\t\tfirstRun = false;\r\n\t\t\t\t\tsetTimeout(function(){ initLock = false;},eventCancelTimer);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (document.readyState === \"interactive\" || document.readyState === \"complete\"){\r\n\t\t\t\t\tfireInit();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlog('Waiting for page ready');\r\n\t\t\t\t\taddEventListener(window,'readystatechange',processRequestFromParent.initFromParent);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\treset: function resetFromParent(){\r\n\t\t\t\tif (!initLock){\r\n\t\t\t\t\tlog('Page size reset by host page');\r\n\t\t\t\t\ttriggerReset('resetPage');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlog('Page reset ignored by init');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tresize: function resizeFromParent(){\r\n\t\t\t\tsendSize('resizeParent','Parent window requested size check');\r\n\t\t\t},\r\n\r\n\t\t\tmoveToAnchor: function moveToAnchorF(){\r\n\t\t\t\tinPageLinks.findTarget(getData());\r\n\t\t\t},\r\n\t\t\tinPageLink: function inPageLinkF() {this.moveToAnchor();}, //Backward compatability\r\n\r\n\t\t\tpageInfo: function pageInfoFromParent(){\r\n\t\t\t\tvar msgBody = getData();\r\n\t\t\t\tlog('PageInfoFromParent called from parent: ' + msgBody );\r\n\t\t\t\tpageInfoCallback(JSON.parse(msgBody));\r\n\t\t\t\tlog(' --');\r\n\t\t\t},\r\n\r\n\t\t\tmessage: function messageFromParent(){\r\n\t\t\t\tvar msgBody = getData();\r\n\r\n\t\t\t\tlog('MessageCallback called from parent: ' + msgBody );\r\n\t\t\t\tmessageCallback(JSON.parse(msgBody));\r\n\t\t\t\tlog(' --');\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction isMessageForUs(){\r\n\t\t\treturn msgID === (''+event.data).substr(0,msgIdLen); //''+ Protects against non-string messages\r\n\t\t}\r\n\r\n\t\tfunction getMessageType(){\r\n\t\t\treturn event.data.split(']')[1].split(':')[0];\r\n\t\t}\r\n\r\n\t\tfunction getData(){\r\n\t\t\treturn event.data.substr(event.data.indexOf(':')+1);\r\n\t\t}\r\n\r\n\t\tfunction isMiddleTier(){\r\n\t\t\treturn !(typeof module !== 'undefined' && module.exports) && ('iFrameResize' in window);\r\n\t\t}\r\n\r\n\t\tfunction isInitMsg(){\r\n\t\t\t//Test if this message is from a child below us. This is an ugly test, however, updating\r\n\t\t\t//the message format would break backwards compatibity.\r\n\t\t\treturn event.data.split(':')[2] in {'true':1,'false':1};\r\n\t\t}\r\n\r\n\t\tfunction callFromParent(){\r\n\t\t\tvar messageType = getMessageType();\r\n\r\n\t\t\tif (messageType in processRequestFromParent){\r\n\t\t\t\tprocessRequestFromParent[messageType]();\r\n\t\t\t} else if (!isMiddleTier() && !isInitMsg()){\r\n\t\t\t\twarn('Unexpected message ('+event.data+')');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction processMessage(){\r\n\t\t\tif (false === firstRun) {\r\n\t\t\t\tcallFromParent();\r\n\t\t\t} else if (isInitMsg()) {\r\n\t\t\t\tprocessRequestFromParent.init();\r\n\t\t\t} else {\r\n\t\t\t\tlog('Ignored message of type \"' + getMessageType() + '\". Received before initialization.');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (isMessageForUs()){\r\n\t\t\tprocessMessage();\r\n\t\t}\r\n\t}\r\n\r\n\t//Normally the parent kicks things off when it detects the iFrame has loaded.\r\n\t//If this script is async-loaded, then tell parent page to retry init.\r\n\tfunction chkLateLoaded(){\r\n\t\tif('loading' !== document.readyState){\r\n\t\t\twindow.parent.postMessage('[iFrameResizerChild]Ready','*');\r\n\t\t}\r\n\t}\r\n\r\n\taddEventListener(window, 'message', receiver);\r\n\tchkLateLoaded();\r\n\r\n\t\r\n\r\n})();\r\n"]}