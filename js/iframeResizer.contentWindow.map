{"version":3,"file":"iframeResizer.contentWindow.min.js","sources":["iframeResizer.contentWindow.js"],"names":["window","addEventListener","el","evt","func","attachEvent","removeEventListener","detachEvent","capitalizeFirstLetter","string","charAt","toUpperCase","slice","throttle","context","args","result","timeout","previous","later","getNow","apply","now","remaining","throttledTimer","this","arguments","clearTimeout","setTimeout","formatLogMsg","msg","msgID","myID","log","logging","console","warn","init","readDataFromParent","location","href","readDataFromPage","setMargin","setBodyStyle","bodyBackground","bodyPadding","injectClearFixIntoBodyElement","checkHeightMode","checkWidthMode","stopInfiniteResizingOfIFrame","setupPublicMethods","startEventListeners","inPageLinks","setupInPageLinks","sendSize","readyCallback","strBool","str","data","initMsg","substr","msgIdLen","split","bodyMargin","undefined","Number","calculateWidth","interval","autoResize","bodyMarginStr","heightCalcMode","tolerance","enable","resizeFrom","widthCalcMode","readData","iFrameResizer","JSON","stringify","messageCallback","targetOriginDefault","targetOrigin","heightCalculationMethod","widthCalculationMethod","Object","constructor","chkCSS","attr","value","indexOf","document","body","style","documentElement","height","manageTriggerEvent","options","handleEvent","eventName","eventType","listener","add","remove","eventNames","Array","prototype","map","method","manageEventListeners","checkCalcMode","calcMode","calcModeDefault","modes","type","heightCalcModeDefault","getHeight","widthCalcModeDefault","getWidth","setupMutationObserver","stopMsgsToParent","sendPermit","removeMsgListener","receiver","disconnectMutationObserver","bodyObserver","disconnect","stopEventListeners","clearInterval","intervalTimer","teardown","clearFix","createElement","clear","display","appendChild","getPagePosition","x","pageXOffset","scrollLeft","y","pageYOffset","scrollTop","getElementPosition","elPosition","getBoundingClientRect","pagePosition","parseInt","left","top","findTarget","jumpToTarget","target","jumpPosition","hash","sendMsg","hashData","decodeURIComponent","getElementById","getElementsByName","checkLocationHash","bindAnchors","setupLink","linkClicked","e","preventDefault","getAttribute","forEach","call","querySelectorAll","bindLocationHash","initCheck","eventCancelTimer","enableInPageLinks","win","parentIFrame","resize","close","getId","getPageInfo","callback","pageInfoCallback","moveToAnchor","reset","resetIFrame","scrollTo","scrollToOffset","sendMessage","setHeightCalculationMethod","setWidthCalculationMethod","setTargetOrigin","size","customHeight","customWidth","valString","initInterval","setInterval","Math","abs","setupBodyMutationObserver","addImageLoadListners","mutation","addImageLoadListener","element","complete","src","imageLoaded","imageError","elements","push","attributeName","removeFromArray","splice","removeImageLoadListener","imageEventTriggered","event","typeDesc","mutationObserved","mutations","createMutationObserver","querySelector","config","attributes","attributeOldValue","characterData","characterDataOldValue","childList","subtree","observer","MutationObserver","observe","WebKitMutationObserver","forceIntervalTimer","getComputedBodyStyle","prop","convertUnitsToPxForIE8","PIXEL","test","base","runtimeStyle","currentStyle","pixelLeft","retVal","defaultView","getComputedStyle","chkEventThottle","timer","getMaxElement","side","elementsLength","length","elVal","maxVal","Side","i","getAllMeasurements","dimention","bodyOffset","bodyScroll","documentElementOffset","documentElementScroll","getTaggedElements","tag","noTaggedElementsFound","getAllElements","sizeIFrame","triggerEvent","triggerEventDesc","resizeIFrame","currentHeight","width","currentWidth","isSizeChangeDetected","checkTolarance","a","b","isForceResizableEvent","isForceResizableCalcMode","resetRequiredMethods","logIgnored","checkDownSizing","lockTrigger","recordTrigger","resetPage","isDoubleFiredEvent","triggerLocked","doubleEventList","sizeIFrameThrottled","triggerLockedTimer","triggerReset","hcm","sendToParent","message","postMessage","isMessageForUs","initFromParent","source","firstRun","initLock","resetFromParent","resizeFromParent","anchor","getData","getMessageType","isMiddleTier","messageFromParent","msgBody","parse","pageInfoFromParent","isInitMsg","true","false","callFromParent","processMessage","chkLateLoaded","readyState","parent","click","max","min","Date","getTime","offsetHeight","offset","scrollHeight","grow","lowestElement","taggedElement","scrollWidth","offsetWidth","scroll","rightMostElement"],"mappings":"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","sourcesContent":["/*\n * File: iframeResizer.contentWindow.js\n * Desc: Include this file in any page being loaded into an iframe\n *       to force the iframe to resize to the content size.\n * Requires: iframeResizer.js on host page.\n * Doc: https://github.com/davidjbradshaw/iframe-resizer\n * Author: David J. Bradshaw - dave@bradshaw.net\n * Contributor: Jure Mav - jure.mav@gmail.com\n * Contributor: Ian Caunce - ian@hallnet.co.uk\n */\n\n\n;(function(window) {\n\t'use strict';\n\n\tvar\n\t\tautoResize            = true,\n\t\tbase                  = 10,\n\t\tbodyBackground        = '',\n\t\tbodyMargin            = 0,\n\t\tbodyMarginStr         = '',\n\t\tbodyObserver          = null,\n\t\tbodyPadding           = '',\n\t\tcalculateWidth        = false,\n\t\tdoubleEventList       = {'resize':1,'click':1},\n\t\teventCancelTimer      = 128,\n\t\tfirstRun              = true,\n\t\theight                = 1,\n\t\theightCalcModeDefault = 'bodyOffset',\n\t\theightCalcMode        = heightCalcModeDefault,\n\t\tinitLock              = true,\n\t\tinitMsg               = '',\n\t\tinPageLinks           = {},\n\t\tinterval              = 32,\n\t\tintervalTimer         = null,\n\t\tlogging               = false,\n\t\tmsgID                 = '[iFrameSizer]',  //Must match host page msg ID\n\t\tmsgIdLen              = msgID.length,\n\t\tmyID                  = '',\n\t\tobserver              = null,\n\t\tresetRequiredMethods  = {max:1,min:1,bodyScroll:1,documentElementScroll:1},\n\t\tresizeFrom            = 'child',\n\t\tsendPermit            = true,\n\t\ttarget                = window.parent,\n\t\ttargetOriginDefault   = '*',\n\t\ttolerance             = 0,\n\t\ttriggerLocked         = false,\n\t\ttriggerLockedTimer    = null,\n\t\tthrottledTimer        = 16,\n\t\twidth                 = 1,\n\t\twidthCalcModeDefault  = 'scroll',\n\t\twidthCalcMode         = widthCalcModeDefault,\n\t\twin                   = window,\n\t\tmessageCallback       = function(){warn('MessageCallback function not defined');},\n\t\treadyCallback         = function(){},\n\t\tpageInfoCallback      = function(){};\n\n\n\tfunction addEventListener(el,evt,func){\n\t\t/* istanbul ignore else */ // Not testable in phantonJS\n\t\tif ('addEventListener' in window){\n\t\t\tel.addEventListener(evt,func, false);\n\t\t} else if ('attachEvent' in window){ //IE\n\t\t\tel.attachEvent('on'+evt,func);\n\t\t}\n\t}\n\n\tfunction removeEventListener(el,evt,func){\n\t\t/* istanbul ignore else */ // Not testable in phantonJS\n\t\tif ('removeEventListener' in window){\n\t\t\tel.removeEventListener(evt,func, false);\n\t\t} else if ('detachEvent' in window){ //IE\n\t\t\tel.detachEvent('on'+evt,func);\n\t\t}\n\t}\n\n\tfunction capitalizeFirstLetter(string) {\n\t\treturn string.charAt(0).toUpperCase() + string.slice(1);\n\t}\n\n\t//Based on underscore.js\n\tfunction throttle(func) {\n\t\tvar\n\t\t\tcontext, args, result,\n\t\t\ttimeout = null,\n\t\t\tprevious = 0,\n\t\t\tlater = function() {\n\t\t\t\tprevious = getNow();\n\t\t\t\ttimeout = null;\n\t\t\t\tresult = func.apply(context, args);\n\t\t\t\tif (!timeout) {\n\t\t\t\t\tcontext = args = null;\n\t\t\t\t}\n\t\t\t};\n\n\t\treturn function() {\n\t\t\tvar now = getNow();\n\n\t\t\tif (!previous) {\n\t\t\t\tprevious = now;\n\t\t\t}\n\n\t\t\tvar remaining = throttledTimer - (now - previous);\n\n\t\t\tcontext = this;\n\t\t\targs = arguments;\n\n\t\t\tif (remaining <= 0 || remaining > throttledTimer) {\n\t\t\t\tif (timeout) {\n\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\ttimeout = null;\n\t\t\t\t}\n\n\t\t\t\tprevious = now;\n\t\t\t\tresult = func.apply(context, args);\n\n\t\t\t\tif (!timeout) {\n\t\t\t\t\tcontext = args = null;\n\t\t\t\t}\n\n\t\t\t} else if (!timeout) {\n\t\t\t\ttimeout = setTimeout(later, remaining);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t};\n\t}\n\n\tvar getNow = Date.now || function() {\n\t\t/* istanbul ignore next */ // Not testable in PhantonJS\n\t\treturn new Date().getTime();\n\t};\n\n\tfunction formatLogMsg(msg){\n\t\treturn msgID + '[' + myID + ']' + ' ' + msg;\n\t}\n\n\tfunction log(msg){\n\t\tif (logging && ('object' === typeof window.console)){\n\t\t\tconsole.log(formatLogMsg(msg));\n\t\t}\n\t}\n\n\tfunction warn(msg){\n\t\tif ('object' === typeof window.console){\n\t\t\tconsole.warn(formatLogMsg(msg));\n\t\t}\n\t}\n\n\n\tfunction init(){\n\t\treadDataFromParent();\n\t\tlog('Initialising iFrame ('+location.href+')');\n\t\treadDataFromPage();\n\t\tsetMargin();\n\t\tsetBodyStyle('background',bodyBackground);\n\t\tsetBodyStyle('padding',bodyPadding);\n\t\tinjectClearFixIntoBodyElement();\n\t\tcheckHeightMode();\n\t\tcheckWidthMode();\n\t\tstopInfiniteResizingOfIFrame();\n\t\tsetupPublicMethods();\n\t\tstartEventListeners();\n\t\tinPageLinks = setupInPageLinks();\n\t\tsendSize('init','Init message from host page');\n\t\treadyCallback();\n\t}\n\n\tfunction readDataFromParent(){\n\n\t\tfunction strBool(str){\n\t\t\treturn 'true' === str ? true : false;\n\t\t}\n\n\t\tvar data = initMsg.substr(msgIdLen).split(':');\n\n\t\tmyID               = data[0];\n\t\tbodyMargin         = (undefined !== data[1]) ? Number(data[1])   : bodyMargin; //For V1 compatibility\n\t\tcalculateWidth     = (undefined !== data[2]) ? strBool(data[2])  : calculateWidth;\n\t\tlogging            = (undefined !== data[3]) ? strBool(data[3])  : logging;\n\t\tinterval           = (undefined !== data[4]) ? Number(data[4])   : interval;\n\t\tautoResize         = (undefined !== data[6]) ? strBool(data[6])  : autoResize;\n\t\tbodyMarginStr      = data[7];\n\t\theightCalcMode     = (undefined !== data[8]) ? data[8]           : heightCalcMode;\n\t\tbodyBackground     = data[9];\n\t\tbodyPadding        = data[10];\n\t\ttolerance          = (undefined !== data[11]) ? Number(data[11]) : tolerance;\n\t\tinPageLinks.enable = (undefined !== data[12]) ? strBool(data[12]): false;\n\t\tresizeFrom         = (undefined !== data[13]) ? data[13]         : resizeFrom;\n\t\twidthCalcMode      = (undefined !== data[14]) ? data[14]         : widthCalcMode;\n\t}\n\n\tfunction readDataFromPage(){\n\t\tfunction readData(){\n\t\t\tvar data = window.iFrameResizer;\n\n\t\t\tlog('Reading data from page: ' + JSON.stringify(data));\n\n\t\t\tmessageCallback     = ('messageCallback'         in data) ? data.messageCallback         : messageCallback;\n\t\t\treadyCallback       = ('readyCallback'           in data) ? data.readyCallback           : readyCallback;\n\t\t\ttargetOriginDefault = ('targetOrigin'            in data) ? data.targetOrigin            : targetOriginDefault;\n\t\t\theightCalcMode      = ('heightCalculationMethod' in data) ? data.heightCalculationMethod : heightCalcMode;\n\t\t\twidthCalcMode       = ('widthCalculationMethod'  in data) ? data.widthCalculationMethod  : widthCalcMode;\n\t\t}\n\n\t\tif(('iFrameResizer' in window) && (Object === window.iFrameResizer.constructor)) {\n\t\t\treadData();\n\t\t}\n\n\t\tlog('TargetOrigin for parent set to: ' + targetOriginDefault);\n\t}\n\n\n\tfunction chkCSS(attr,value){\n\t\tif (-1 !== value.indexOf('-')){\n\t\t\twarn('Negative CSS value ignored for '+attr);\n\t\t\tvalue='';\n\t\t}\n\t\treturn value;\n\t}\n\n\tfunction setBodyStyle(attr,value){\n\t\tif ((undefined !== value) && ('' !== value) && ('null' !== value)){\n\t\t\tdocument.body.style[attr] = value;\n\t\t\tlog('Body '+attr+' set to \"'+value+'\"');\n\t\t}\n\t}\n\n\tfunction setMargin(){\n\t\t//If called via V1 script, convert bodyMargin from int to str\n\t\tif (undefined === bodyMarginStr){\n\t\t\tbodyMarginStr = bodyMargin+'px';\n\t\t}\n\n\t\tsetBodyStyle('margin',chkCSS('margin',bodyMarginStr));\n\t}\n\n\tfunction stopInfiniteResizingOfIFrame(){\n\t\tdocument.documentElement.style.height = '';\n\t\tdocument.body.style.height = '';\n\t\tlog('HTML & body height set to \"auto\"');\n\t}\n\n\n\tfunction manageTriggerEvent(options){\n\t\tfunction handleEvent(){\n\t\t\tsendSize(options.eventName,options.eventType);\n\t\t}\n\n\t\tvar listener = {\n\t\t\tadd:    function(eventName){\n\t\t\t\taddEventListener(window,eventName,handleEvent);\n\t\t\t},\n\t\t\tremove: function(eventName){\n\t\t\t\tremoveEventListener(window,eventName,handleEvent);\n\t\t\t}\n\t\t};\n\n\t\tif(options.eventNames && Array.prototype.map){\n\t\t\toptions.eventName = options.eventNames[0];\n\t\t\toptions.eventNames.map(listener[options.method]);\n\t\t} else {\n\t\t\tlistener[options.method](options.eventName);\n\t\t}\n\n\t\tlog(capitalizeFirstLetter(options.method) + ' event listener: ' + options.eventType);\n\t}\n\n\tfunction manageEventListeners(method){\n\t\tmanageTriggerEvent({method:method, eventType: 'Animation Start',           eventNames: ['animationstart','webkitAnimationStart'] });\n\t\tmanageTriggerEvent({method:method, eventType: 'Animation Iteration',       eventNames: ['animationiteration','webkitAnimationIteration'] });\n\t\tmanageTriggerEvent({method:method, eventType: 'Animation End',             eventNames: ['animationend','webkitAnimationEnd'] });\n\t\tmanageTriggerEvent({method:method, eventType: 'Input',                     eventName:  'input' });\n\t\tmanageTriggerEvent({method:method, eventType: 'Mouse Up',                  eventName:  'mouseup' });\n\t\tmanageTriggerEvent({method:method, eventType: 'Mouse Down',                eventName:  'mousedown' });\n\t\tmanageTriggerEvent({method:method, eventType: 'Orientation Change',        eventName:  'orientationchange' });\n\t\tmanageTriggerEvent({method:method, eventType: 'Touch Start',               eventName:  'touchstart' });\n\t\tmanageTriggerEvent({method:method, eventType: 'Touch End',                 eventName:  'touchend' });\n\t\tmanageTriggerEvent({method:method, eventType: 'Touch Cancel',              eventName:  'touchcancel' });\n\t\tmanageTriggerEvent({method:method, eventType: 'Print',                     eventName:  ['afterprint', 'beforeprint'] });\n\t\tmanageTriggerEvent({method:method, eventType: 'Transition Start',          eventNames: ['transitionstart','webkitTransitionStart','MSTransitionStart','oTransitionStart','otransitionstart'] });\n\t\tmanageTriggerEvent({method:method, eventType: 'Transition Iteration',      eventNames: ['transitioniteration','webkitTransitionIteration','MSTransitionIteration','oTransitionIteration','otransitioniteration'] });\n\t\tmanageTriggerEvent({method:method, eventType: 'Transition End',            eventNames: ['transitionend','webkitTransitionEnd','MSTransitionEnd','oTransitionEnd','otransitionend'] });\n\t\tif('child' === resizeFrom){\n\t\t\tmanageTriggerEvent({method:method, eventType: 'IFrame Resized',        eventName:  'resize' });\n\t\t}\n\t}\n\n\tfunction checkCalcMode(calcMode,calcModeDefault,modes,type){\n\t\tif (calcModeDefault !== calcMode){\n\t\t\tif (!(calcMode in modes)){\n\t\t\t\twarn(calcMode + ' is not a valid option for '+type+'CalculationMethod.');\n\t\t\t\tcalcMode=calcModeDefault;\n\t\t\t}\n\t\t\tlog(type+' calculation method set to \"'+calcMode+'\"');\n\t\t}\n\n\t\treturn calcMode;\n\t}\n\n\tfunction checkHeightMode(){\n\t\theightCalcMode = checkCalcMode(heightCalcMode,heightCalcModeDefault,getHeight,'height');\n\t}\n\n\tfunction checkWidthMode(){\n\t\twidthCalcMode = checkCalcMode(widthCalcMode,widthCalcModeDefault,getWidth,'width');\n\t}\n\n\tfunction startEventListeners(){\n\t\tif ( true === autoResize ) {\n\t\t\tmanageEventListeners('add');\n\t\t\tsetupMutationObserver();\n\t\t}\n\t\telse {\n\t\t\tlog('Auto Resize disabled');\n\t\t}\n\t}\n\n\tfunction stopMsgsToParent(){\n\t\tlog('Disable outgoing messages');\n\t\tsendPermit = false;\n\t}\n\n\tfunction removeMsgListener(){\n\t\tlog('Remove event listener: Message');\n\t\tremoveEventListener(window, 'message', receiver);\n\t}\n\n\tfunction disconnectMutationObserver(){\n\t\tif (null !== bodyObserver){\n\t\t\t/* istanbul ignore next */ // Not testable in PhantonJS\n\t\t\tbodyObserver.disconnect();\n\t\t}\n\t}\n\n\tfunction stopEventListeners(){\n\t\tmanageEventListeners('remove');\n\t\tdisconnectMutationObserver();\n\t\tclearInterval(intervalTimer);\n\t}\n\n\tfunction teardown(){\n\t\tstopMsgsToParent();\n\t\tremoveMsgListener();\n\t\tif (true === autoResize) stopEventListeners();\n\t}\n\n\tfunction injectClearFixIntoBodyElement(){\n\t\tvar clearFix = document.createElement('div');\n\t\tclearFix.style.clear   = 'both';\n\t\tclearFix.style.display = 'block'; //Guard against this having been globally redefined in CSS.\n\t\tdocument.body.appendChild(clearFix);\n\t}\n\n\tfunction setupInPageLinks(){\n\n\t\tfunction getPagePosition (){\n\t\t\treturn {\n\t\t\t\tx: (window.pageXOffset !== undefined) ? window.pageXOffset : document.documentElement.scrollLeft,\n\t\t\t\ty: (window.pageYOffset !== undefined) ? window.pageYOffset : document.documentElement.scrollTop\n\t\t\t};\n\t\t}\n\n\t\tfunction getElementPosition(el){\n\t\t\tvar\n\t\t\t\telPosition   = el.getBoundingClientRect(),\n\t\t\t\tpagePosition = getPagePosition();\n\n\t\t\treturn {\n\t\t\t\tx: parseInt(elPosition.left,10) + parseInt(pagePosition.x,10),\n\t\t\t\ty: parseInt(elPosition.top,10)  + parseInt(pagePosition.y,10)\n\t\t\t};\n\t\t}\n\n\t\tfunction findTarget(location){\n\t\t\tfunction jumpToTarget(target){\n\t\t\t\tvar jumpPosition = getElementPosition(target);\n\n\t\t\t\tlog('Moving to in page link (#'+hash+') at x: '+jumpPosition.x+' y: '+jumpPosition.y);\n\t\t\t\tsendMsg(jumpPosition.y, jumpPosition.x, 'scrollToOffset'); // X&Y reversed at sendMsg uses height/width\n\t\t\t}\n\n\t\t\tvar\n\t\t\t\thash     = location.split('#')[1] || location, //Remove # if present\n\t\t\t\thashData = decodeURIComponent(hash),\n\t\t\t\ttarget   = document.getElementById(hashData) || document.getElementsByName(hashData)[0];\n\n\t\t\tif (undefined !== target){\n\t\t\t\tjumpToTarget(target);\n\t\t\t} else {\n\t\t\t\tlog('In page link (#' + hash + ') not found in iFrame, so sending to parent');\n\t\t\t\tsendMsg(0,0,'inPageLink','#'+hash);\n\t\t\t}\n\t\t}\n\n\t\tfunction checkLocationHash(){\n\t\t\tif ('' !== location.hash && '#' !== location.hash){\n\t\t\t\tfindTarget(location.href);\n\t\t\t}\n\t\t}\n\n\t\tfunction bindAnchors(){\n\t\t\tfunction setupLink(el){\n\t\t\t\tfunction linkClicked(e){\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t/*jshint validthis:true */\n\t\t\t\t\tfindTarget(this.getAttribute('href'));\n\t\t\t\t}\n\n\t\t\t\tif ('#' !== el.getAttribute('href')){\n\t\t\t\t\taddEventListener(el,'click',linkClicked);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tArray.prototype.forEach.call( document.querySelectorAll( 'a[href^=\"#\"]' ), setupLink );\n\t\t}\n\n\t\tfunction bindLocationHash(){\n\t\t\taddEventListener(window,'hashchange',checkLocationHash);\n\t\t}\n\n\t\tfunction initCheck(){ //check if page loaded with location hash after init resize\n\t\t\tsetTimeout(checkLocationHash,eventCancelTimer);\n\t\t}\n\n\t\tfunction enableInPageLinks(){\n\t\t\t/* istanbul ignore else */ // Not testable in phantonJS\n\t\t\tif(Array.prototype.forEach && document.querySelectorAll){\n\t\t\t\tlog('Setting up location.hash handlers');\n\t\t\t\tbindAnchors();\n\t\t\t\tbindLocationHash();\n\t\t\t\tinitCheck();\n\t\t\t} else {\n\t\t\t\twarn('In page linking not fully supported in this browser! (See README.md for IE8 workaround)');\n\t\t\t}\n\t\t}\n\n\t\tif(inPageLinks.enable){\n\t\t\tenableInPageLinks();\n\t\t} else {\n\t\t\tlog('In page linking not enabled');\n\t\t}\n\n\t\treturn {\n\t\t\tfindTarget:findTarget\n\t\t};\n\t}\n\n\tfunction setupPublicMethods(){\n\t\tlog('Enable public methods');\n\n\t\twin.parentIFrame = {\n\n\t\t\tautoResize: function autoResizeF(resize){\n\t\t\t\tif (true === resize && false === autoResize) {\n\t\t\t\t\tautoResize=true;\n\t\t\t\t\tstartEventListeners();\n\t\t\t\t\t//sendSize('autoResize','Auto Resize enabled');\n\t\t\t\t} else if (false === resize && true === autoResize) {\n\t\t\t\t\tautoResize=false;\n\t\t\t\t\tstopEventListeners();\n\t\t\t\t}\n\n\t\t\t\treturn autoResize;\n\t\t\t},\n\n\t\t\tclose: function closeF(){\n\t\t\t\tsendMsg(0,0,'close');\n\t\t\t\tteardown();\n\t\t\t},\n\n\t\t\tgetId: function getIdF(){\n\t\t\t\treturn myID;\n\t\t\t},\n\n\t\t\tgetPageInfo: function getPageInfoF(callback){\n\t\t\t\tpageInfoCallback = callback;\n\t\t\t\tsendMsg(0,0,'pageInfo');\n\t\t\t},\n\n\t\t\tmoveToAnchor: function moveToAnchorF(hash){\n\t\t\t\tinPageLinks.findTarget(hash);\n\t\t\t},\n\n\t\t\treset: function resetF(){\n\t\t\t\tresetIFrame('parentIFrame.reset');\n\t\t\t},\n\n\t\t\tscrollTo: function scrollToF(x,y){\n\t\t\t\tsendMsg(y,x,'scrollTo'); // X&Y reversed at sendMsg uses height/width\n\t\t\t},\n\n\t\t\tscrollToOffset: function scrollToF(x,y){\n\t\t\t\tsendMsg(y,x,'scrollToOffset'); // X&Y reversed at sendMsg uses height/width\n\t\t\t},\n\n\t\t\tsendMessage: function sendMessageF(msg,targetOrigin){\n\t\t\t\tsendMsg(0,0,'message',JSON.stringify(msg),targetOrigin);\n\t\t\t},\n\n\t\t\tsetHeightCalculationMethod: function setHeightCalculationMethodF(heightCalculationMethod){\n\t\t\t\theightCalcMode = heightCalculationMethod;\n\t\t\t\tcheckHeightMode();\n\t\t\t},\n\n\t\t\tsetWidthCalculationMethod: function setWidthCalculationMethodF(widthCalculationMethod){\n\t\t\t\twidthCalcMode = widthCalculationMethod;\n\t\t\t\tcheckWidthMode();\n\t\t\t},\n\n\t\t\tsetTargetOrigin: function setTargetOriginF(targetOrigin){\n\t\t\t\tlog('Set targetOrigin: '+targetOrigin);\n\t\t\t\ttargetOriginDefault = targetOrigin;\n\t\t\t},\n\n\t\t\tsize: function sizeF(customHeight, customWidth){\n\t\t\t\tvar valString = ''+(customHeight?customHeight:'')+(customWidth?','+customWidth:'');\n\t\t\t\t//lockTrigger();\n\t\t\t\tsendSize('size','parentIFrame.size('+valString+')', customHeight, customWidth);\n\t\t\t}\n\t\t};\n\t}\n\n\tfunction initInterval(){\n\t\tif ( 0 !== interval ){\n\t\t\tlog('setInterval: '+interval+'ms');\n\t\t\tintervalTimer = setInterval(function(){\n\t\t\t\tsendSize('interval','setInterval: '+interval);\n\t\t\t},Math.abs(interval));\n\t\t}\n\t}\n\n\t/* istanbul ignore next */  //Not testable in PhantomJS\n\tfunction setupBodyMutationObserver(){\n\t\tfunction addImageLoadListners(mutation) {\n\t\t\tfunction addImageLoadListener(element){\n\t\t\t\tif (false === element.complete) {\n\t\t\t\t\tlog('Attach listeners to ' + element.src);\n\t\t\t\t\telement.addEventListener('load', imageLoaded, false);\n\t\t\t\t\telement.addEventListener('error', imageError, false);\n\t\t\t\t\telements.push(element);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (mutation.type === 'attributes' && mutation.attributeName === 'src'){\n\t\t\t\taddImageLoadListener(mutation.target);\n\t\t\t} else if (mutation.type === 'childList'){\n\t\t\t\tArray.prototype.forEach.call(\n\t\t\t\t\tmutation.target.querySelectorAll('img'),\n\t\t\t\t\taddImageLoadListener\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tfunction removeFromArray(element){\n\t\t\telements.splice(elements.indexOf(element),1);\n\t\t}\n\n\t\tfunction removeImageLoadListener(element){\n\t\t\tlog('Remove listeners from ' + element.src);\n\t\t\telement.removeEventListener('load', imageLoaded, false);\n\t\t\telement.removeEventListener('error', imageError, false);\n\t\t\tremoveFromArray(element);\n\t\t}\n\n\t\tfunction imageEventTriggered(event,type,typeDesc){\n\t\t\tremoveImageLoadListener(event.target);\n\t\t\tsendSize(type, typeDesc + ': ' + event.target.src, undefined, undefined);\n\t\t}\n\n\t\tfunction imageLoaded(event) {\n\t\t\timageEventTriggered(event,'imageLoad','Image loaded');\n\t\t}\n\n\t\tfunction imageError(event) {\n\t\t\timageEventTriggered(event,'imageLoadFailed','Image load failed');\n\t\t}\n\n\t\tfunction mutationObserved(mutations) {\n\t\t\tsendSize('mutationObserver','mutationObserver: ' + mutations[0].target + ' ' + mutations[0].type);\n\n\t\t\t//Deal with WebKit asyncing image loading when tags are injected into the page\n\t\t\tmutations.forEach(addImageLoadListners);\n\t\t}\n\n\t\tfunction createMutationObserver(){\n\t\t\tvar\n\t\t\t\ttarget = document.querySelector('body'),\n\n\t\t\t\tconfig = {\n\t\t\t\t\tattributes            : true,\n\t\t\t\t\tattributeOldValue     : false,\n\t\t\t\t\tcharacterData         : true,\n\t\t\t\t\tcharacterDataOldValue : false,\n\t\t\t\t\tchildList             : true,\n\t\t\t\t\tsubtree               : true\n\t\t\t\t};\n\n\t\t\tobserver = new MutationObserver(mutationObserved);\n\n\t\t\tlog('Create body MutationObserver');\n\t\t\tobserver.observe(target, config);\n\n\t\t\treturn observer;\n\t\t}\n\n\t\tvar\n\t\t\telements         = [],\n\t\t\tMutationObserver = window.MutationObserver || window.WebKitMutationObserver,\n\t\t\tobserver         = createMutationObserver();\n\n\t\treturn {\n\t\t\tdisconnect: function (){\n\t\t\t\tif ('disconnect' in observer){\n\t\t\t\t\tlog('Disconnect body MutationObserver');\n\t\t\t\t\tobserver.disconnect();\n\t\t\t\t\telements.forEach(removeImageLoadListener);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tfunction setupMutationObserver(){\n\t\tvar\tforceIntervalTimer = 0 > interval;\n\n\t\t/* istanbul ignore if */ // Not testable in PhantomJS\n\t\tif (window.MutationObserver || window.WebKitMutationObserver){\n\t\t\tif (forceIntervalTimer) {\n\t\t\t\tinitInterval();\n\t\t\t} else {\n\t\t\t\tbodyObserver = setupBodyMutationObserver();\n\t\t\t}\n\t\t} else {\n\t\t\tlog('MutationObserver not supported in this browser!');\n\t\t\tinitInterval();\n\t\t}\n\t}\n\n\n\t// document.documentElement.offsetHeight is not reliable, so\n\t// we have to jump through hoops to get a better value.\n\tfunction getComputedBodyStyle(prop) {\n\t\t/* istanbul ignore next */  //Not testable in PhantomJS\n\t\tfunction convertUnitsToPxForIE8(value) {\n\t\t\tvar PIXEL = /^\\d+(px)?$/i;\n\n\t\t\tif (PIXEL.test(value)) {\n\t\t\t\treturn parseInt(value,base);\n\t\t\t}\n\n\t\t\tvar\n\t\t\t\tstyle = el.style.left,\n\t\t\t\truntimeStyle = el.runtimeStyle.left;\n\n\t\t\tel.runtimeStyle.left = el.currentStyle.left;\n\t\t\tel.style.left = value || 0;\n\t\t\tvalue = el.style.pixelLeft;\n\t\t\tel.style.left = style;\n\t\t\tel.runtimeStyle.left = runtimeStyle;\n\n\t\t\treturn value;\n\t\t}\n\n\t\tvar\n\t\t\tel = document.body,\n\t\t\tretVal = 0;\n\n\t\t/* istanbul ignore else */ // Not testable in phantonJS\n\t\tif (('defaultView' in document) && ('getComputedStyle' in document.defaultView)) {\n\t\t\tretVal = document.defaultView.getComputedStyle(el, null);\n\t\t\tretVal = (null !== retVal) ? retVal[prop] : 0;\n\t\t} else {//IE8\n\t\t\tretVal =  convertUnitsToPxForIE8(el.currentStyle[prop]);\n\t\t}\n\n\t\treturn parseInt(retVal,base);\n\t}\n\n\tfunction chkEventThottle(timer){\n\t\tif(timer > throttledTimer/2){\n\t\t\tthrottledTimer = 2*timer;\n\t\t\tlog('Event throttle increased to ' + throttledTimer + 'ms');\n\t\t}\n\t}\n\n\t//Idea from https://github.com/guardian/iframe-messenger\n\tfunction getMaxElement(side,elements) {\n\t\tvar\n\t\t\telementsLength = elements.length,\n\t\t\telVal          = 0,\n\t\t\tmaxVal         = 0,\n\t\t\tSide           = capitalizeFirstLetter(side),\n\t\t\ttimer          = getNow();\n\n\t\tfor (var i = 0; i < elementsLength; i++) {\n\t\t\telVal = elements[i].getBoundingClientRect()[side] + getComputedBodyStyle('margin'+Side);\n\t\t\tif (elVal > maxVal) {\n\t\t\t\tmaxVal = elVal;\n\t\t\t}\n\t\t}\n\n\t\ttimer = getNow() - timer;\n\n\t\tlog('Parsed '+elementsLength+' HTML elements');\n\t\tlog('Element position calculated in ' + timer + 'ms');\n\n\t\tchkEventThottle(timer);\n\n\t\treturn maxVal;\n\t}\n\n\tfunction getAllMeasurements(dimention){\n\t\treturn [\n\t\t\tdimention.bodyOffset(),\n\t\t\tdimention.bodyScroll(),\n\t\t\tdimention.documentElementOffset(),\n\t\t\tdimention.documentElementScroll()\n\t\t];\n\t}\n\n\tfunction getTaggedElements(side,tag){\n\t\tfunction noTaggedElementsFound(){\n\t\t\twarn('No tagged elements ('+tag+') found on page');\n\t\t\treturn height; //current height\n\t\t}\n\n\t\tvar elements = document.querySelectorAll('['+tag+']');\n\n\t\treturn 0 === elements.length ?  noTaggedElementsFound() : getMaxElement(side,elements);\n\t}\n\n\tfunction getAllElements(){\n\t\treturn document.querySelectorAll('body *');\n\t}\n\n\tvar\n\t\tgetHeight = {\n\t\t\tbodyOffset: function getBodyOffsetHeight(){\n\t\t\t\treturn  document.body.offsetHeight + getComputedBodyStyle('marginTop') + getComputedBodyStyle('marginBottom');\n\t\t\t},\n\n\t\t\toffset: function(){\n\t\t\t\treturn getHeight.bodyOffset(); //Backwards compatability\n\t\t\t},\n\n\t\t\tbodyScroll: function getBodyScrollHeight(){\n\t\t\t\treturn document.body.scrollHeight;\n\t\t\t},\n\n\t\t\tdocumentElementOffset: function getDEOffsetHeight(){\n\t\t\t\treturn document.documentElement.offsetHeight;\n\t\t\t},\n\n\t\t\tdocumentElementScroll: function getDEScrollHeight(){\n\t\t\t\treturn document.documentElement.scrollHeight;\n\t\t\t},\n\n\t\t\tmax: function getMaxHeight(){\n\t\t\t\treturn Math.max.apply(null,getAllMeasurements(getHeight));\n\t\t\t},\n\n\t\t\tmin: function getMinHeight(){\n\t\t\t\treturn Math.min.apply(null,getAllMeasurements(getHeight));\n\t\t\t},\n\n\t\t\tgrow: function growHeight(){\n\t\t\t\treturn getHeight.max(); //Run max without the forced downsizing\n\t\t\t},\n\n\t\t\tlowestElement: function getBestHeight(){\n\t\t\t\treturn Math.max(getHeight.bodyOffset(), getMaxElement('bottom',getAllElements()));\n\t\t\t},\n\n\t\t\ttaggedElement: function getTaggedElementsHeight(){\n\t\t\t\treturn getTaggedElements('bottom','data-iframe-height');\n\t\t\t}\n\t\t},\n\n\t\tgetWidth = {\n\t\t\tbodyScroll: function getBodyScrollWidth(){\n\t\t\t\treturn document.body.scrollWidth;\n\t\t\t},\n\n\t\t\tbodyOffset: function getBodyOffsetWidth(){\n\t\t\t\treturn document.body.offsetWidth;\n\t\t\t},\n\n\t\t\tdocumentElementScroll: function getDEScrollWidth(){\n\t\t\t\treturn document.documentElement.scrollWidth;\n\t\t\t},\n\n\t\t\tdocumentElementOffset: function getDEOffsetWidth(){\n\t\t\t\treturn document.documentElement.offsetWidth;\n\t\t\t},\n\n\t\t\tscroll: function getMaxWidth(){\n\t\t\t\treturn Math.max(getWidth.bodyScroll(), getWidth.documentElementScroll());\n\t\t\t},\n\n\t\t\tmax: function getMaxWidth(){\n\t\t\t\treturn Math.max.apply(null,getAllMeasurements(getWidth));\n\t\t\t},\n\n\t\t\tmin: function getMinWidth(){\n\t\t\t\treturn Math.min.apply(null,getAllMeasurements(getWidth));\n\t\t\t},\n\n\t\t\trightMostElement: function rightMostElement(){\n\t\t\t\treturn getMaxElement('right', getAllElements());\n\t\t\t},\n\n\t\t\ttaggedElement: function getTaggedElementsWidth(){\n\t\t\t\treturn getTaggedElements('right', 'data-iframe-width');\n\t\t\t}\n\t\t};\n\n\n\tfunction sizeIFrame(triggerEvent, triggerEventDesc, customHeight, customWidth){\n\n\t\tfunction resizeIFrame(){\n\t\t\theight = currentHeight;\n\t\t\twidth  = currentWidth;\n\n\t\t\tsendMsg(height,width,triggerEvent);\n\t\t}\n\n\t\tfunction isSizeChangeDetected(){\n\t\t\tfunction checkTolarance(a,b){\n\t\t\t\tvar retVal = Math.abs(a-b) <= tolerance;\n\t\t\t\treturn !retVal;\n\t\t\t}\n\n\t\t\tcurrentHeight = (undefined !== customHeight)  ? customHeight : getHeight[heightCalcMode]();\n\t\t\tcurrentWidth  = (undefined !== customWidth )  ? customWidth  : getWidth[widthCalcMode]();\n\n\t\t\treturn\tcheckTolarance(height,currentHeight) || (calculateWidth && checkTolarance(width,currentWidth));\n\t\t}\n\n\t\tfunction isForceResizableEvent(){\n\t\t\treturn !(triggerEvent in {'init':1,'interval':1,'size':1});\n\t\t}\n\n\t\tfunction isForceResizableCalcMode(){\n\t\t\treturn (heightCalcMode in resetRequiredMethods) || (calculateWidth && widthCalcMode in resetRequiredMethods);\n\t\t}\n\n\t\tfunction logIgnored(){\n\t\t\tlog('No change in size detected');\n\t\t}\n\n\t\tfunction checkDownSizing(){\n\t\t\tif (isForceResizableEvent() && isForceResizableCalcMode()){\n\t\t\t\tresetIFrame(triggerEventDesc);\n\t\t\t} else if (!(triggerEvent in {'interval':1})){\n\t\t\t\tlogIgnored();\n\t\t\t}\n\t\t}\n\n\t\tvar\tcurrentHeight,currentWidth;\n\n\t\tif (isSizeChangeDetected() || 'init' === triggerEvent){\n\t\t\tlockTrigger();\n\t\t\tresizeIFrame();\n\t\t} else {\n\t\t\tcheckDownSizing();\n\t\t}\n\t}\n\n\tvar sizeIFrameThrottled = throttle(sizeIFrame);\n\n\tfunction sendSize(triggerEvent, triggerEventDesc, customHeight, customWidth){\n\t\tfunction recordTrigger(){\n\t\t\tif (!(triggerEvent in {'reset':1,'resetPage':1,'init':1})){\n\t\t\t\tlog( 'Trigger event: ' + triggerEventDesc );\n\t\t\t}\n\t\t}\n\n\t\tfunction isDoubleFiredEvent(){\n\t\t\treturn  triggerLocked && (triggerEvent in doubleEventList);\n\t\t}\n\n\t\tif (!isDoubleFiredEvent()){\n\t\t\trecordTrigger();\n\t\t\tsizeIFrameThrottled(triggerEvent, triggerEventDesc, customHeight, customWidth);\n\t\t} else {\n\t\t\tlog('Trigger event cancelled: '+triggerEvent);\n\t\t}\n\t}\n\n\tfunction lockTrigger(){\n\t\tif (!triggerLocked){\n\t\t\ttriggerLocked = true;\n\t\t\tlog('Trigger event lock on');\n\t\t}\n\t\tclearTimeout(triggerLockedTimer);\n\t\ttriggerLockedTimer = setTimeout(function(){\n\t\t\ttriggerLocked = false;\n\t\t\tlog('Trigger event lock off');\n\t\t\tlog('--');\n\t\t},eventCancelTimer);\n\t}\n\n\tfunction triggerReset(triggerEvent){\n\t\theight = getHeight[heightCalcMode]();\n\t\twidth  = getWidth[widthCalcMode]();\n\n\t\tsendMsg(height,width,triggerEvent);\n\t}\n\n\tfunction resetIFrame(triggerEventDesc){\n\t\tvar hcm = heightCalcMode;\n\t\theightCalcMode = heightCalcModeDefault;\n\n\t\tlog('Reset trigger event: ' + triggerEventDesc);\n\t\tlockTrigger();\n\t\ttriggerReset('reset');\n\n\t\theightCalcMode = hcm;\n\t}\n\n\tfunction sendMsg(height,width,triggerEvent,msg,targetOrigin){\n\t\tfunction setTargetOrigin(){\n\t\t\tif (undefined === targetOrigin){\n\t\t\t\ttargetOrigin = targetOriginDefault;\n\t\t\t} else {\n\t\t\t\tlog('Message targetOrigin: '+targetOrigin);\n\t\t\t}\n\t\t}\n\n\t\tfunction sendToParent(){\n\t\t\tvar\n\t\t\t\tsize  = height + ':' + width,\n\t\t\t\tmessage = myID + ':' +  size + ':' + triggerEvent + (undefined !== msg ? ':' + msg : '');\n\n\t\t\tlog('Sending message to host page (' + message + ')');\n\t\t\ttarget.postMessage( msgID + message, targetOrigin);\n\t\t}\n\n\t\tif(true === sendPermit){\n\t\t\tsetTargetOrigin();\n\t\t\tsendToParent();\n\t\t}\n\t}\n\n\tfunction receiver(event) {\n\t\tfunction isMessageForUs(){\n\t\t\treturn msgID === (''+event.data).substr(0,msgIdLen); //''+ Protects against non-string messages\n\t\t}\n\n\t\tfunction initFromParent(){\n\t\t\tinitMsg = event.data;\n\t\t\ttarget  = event.source;\n\n\t\t\tinit();\n\t\t\tfirstRun = false;\n\t\t\tsetTimeout(function(){ initLock = false;},eventCancelTimer);\n\t\t}\n\n\t\tfunction resetFromParent(){\n\t\t\tif (!initLock){\n\t\t\t\tlog('Page size reset by host page');\n\t\t\t\ttriggerReset('resetPage');\n\t\t\t} else {\n\t\t\t\tlog('Page reset ignored by init');\n\t\t\t}\n\t\t}\n\n\t\tfunction resizeFromParent(){\n\t\t\tsendSize('resizeParent','Parent window requested size check');\n\t\t}\n\n\t\tfunction moveToAnchor(){\n\t\t\tvar anchor = getData();\n\t\t\tinPageLinks.findTarget(anchor);\n\t\t}\n\n\t\tfunction getMessageType(){\n\t\t\treturn event.data.split(']')[1].split(':')[0];\n\t\t}\n\n\t\tfunction getData(){\n\t\t\treturn event.data.substr(event.data.indexOf(':')+1);\n\t\t}\n\n\t\tfunction isMiddleTier(){\n\t\t\treturn ('iFrameResize' in window);\n\t\t}\n\n\t\tfunction messageFromParent(){\n\t\t\tvar msgBody = getData();\n\n\t\t\tlog('MessageCallback called from parent: ' + msgBody );\n\t\t\tmessageCallback(JSON.parse(msgBody));\n\t\t\tlog(' --');\n\t\t}\n\n\t\tfunction pageInfoFromParent(){\n\t\t\tvar msgBody = getData();\n\t\t\tlog('PageInfoFromParent called from parent: ' + msgBody );\n\t\t\tpageInfoCallback(JSON.parse(msgBody));\n\t\t\tlog(' --');\n\t\t}\n\n\t\tfunction isInitMsg(){\n\t\t\t//Test if this message is from a child below us. This is an ugly test, however, updating\n\t\t\t//the message format would break backwards compatibity.\n\t\t\treturn event.data.split(':')[2] in {'true':1,'false':1};\n\t\t}\n\n\t\tfunction callFromParent(){\n\t\t\tswitch (getMessageType()){\n\t\t\tcase 'reset':\n\t\t\t\tresetFromParent();\n\t\t\t\tbreak;\n\t\t\tcase 'resize':\n\t\t\t\tresizeFromParent();\n\t\t\t\tbreak;\n\t\t\tcase 'moveToAnchor':\n\t\t\t\tmoveToAnchor();\n\t\t\t\tbreak;\n\t\t\tcase 'message':\n\t\t\t\tmessageFromParent();\n\t\t\t\tbreak;\n\t\t\tcase 'pageInfo':\n\t\t\t\tpageInfoFromParent();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif (!isMiddleTier() && !isInitMsg()){\n\t\t\t\t\twarn('Unexpected message ('+event.data+')');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction processMessage(){\n\t\t\tif (false === firstRun) {\n\t\t\t\tcallFromParent();\n\t\t\t} else if (isInitMsg()) {\n\t\t\t\tinitFromParent();\n\t\t\t} else {\n\t\t\t\tlog('Ignored message of type \"' + getMessageType() + '\". Received before initialization.');\n\t\t\t}\n\t\t}\n\n\t\tif (isMessageForUs()){\n\t\t\tprocessMessage();\n\t\t}\n\t}\n\n\t//Normally the parent kicks things off when it detects the iFrame has loaded.\n\t//If this script is async-loaded, then tell parent page to retry init.\n\tfunction chkLateLoaded(){\n\t\tif('loading' !== document.readyState){\n\t\t\twindow.parent.postMessage('[iFrameResizerChild]Ready','*');\n\t\t}\n\t}\n\n\taddEventListener(window, 'message', receiver);\n\tchkLateLoaded();\n\n\t\n\n})(window || {});\n"]}